- name: Check job status until {{ condition.success }} or {{ condition.fail }}
  shell: >
   {{{ shell }}}
  register: cmd_result
  changed_when: false
  retries: {{ timeout }}
  delay: 1
  until: cmd_result.stdout in ["{{ condition.success }}", "{{ condition.fail }}"]

- name: Got job status
  debug:
    msg: "Job status: {{ cmd_result_stdout }}"

- name: Fail the play if job failed
  fail:
    msg: "Job has failed with status: {{ cmd_result_stdout }}"
  when: cmd_result.stdout == "{{ condition.fail }}"
